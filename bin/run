#!/usr/bin/env node

import { resolve } from 'node:path';
import { createServer } from 'vite';
import { serverPort, remoteUrls } from '../dist/server/index.es.js';
import chalk from 'chalk';
import vue from '@vitejs/plugin-vue';
import tailwindcss from '@tailwindcss/vite';
// import eslint from 'vite-plugin-eslint';
import paris from 'paris-vite-plugin';


// Variables

export const DIR = process.cwd();


// Functions

export function log(message, color) {
    const handle = chalk[color] ?? chalk.green;

    if (!handle) {
        console.log(chalk.yellow(`(!) Paris Internal Error: Unknown color '${color}'`))
        console.log(message);

        return;
    }

    console.log(handle(message));
}

export async function use() {
    const vite = await createServer({
        root: resolve(DIR, './dist/shell'),
        plugins: [
            vue(),
            tailwindcss(),
            // eslint(),
            paris({
                remotes: remoteUrls,
            }),
        ],
        resolve: {
            alias: {
                '@': resolve(DIR, './dist/shell'),
            },
        },
    });

    await vite.listen(serverPort);

    log('(+) Paris: Server started and listening on port ' + serverPort);
}


use().catch(console.error);
